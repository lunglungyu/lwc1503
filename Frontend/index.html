<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="cache-control" content="max-age=0" />
		<meta http-equiv="cache-control" content="no-cache" />
		<meta http-equiv="expires" content="0" />
		<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
		<meta http-equiv="pragma" content="no-cache" />
		<style>
/*
#.bubble circle{
	fill: #ccc;
	stroke: #aaa;
}
    */
		</style> 
	</head>
	<body>
		<div id="container" style="position: relative; width: 1300px; height: 1000px;"></div>
		<script src="bower_components/jquery/dist/jquery.min.js"></script>
		<script src="bower_components/d3/d3.min.js"></script>
		<script src="bower_components/topojson/topojson.js"></script>
		<script src="bower_components/datamaps/dist/datamaps.all.min.js"></script>
		<script>
var projection, path;
var map = new Datamap({
	element: document.getElementById('container'),
	geographyConfig: {
		dataUrl: 'data/china_topojson.json'
	},
	scope: 'china',
	setProjection: function(element, options) {
		projection = d3.geo.mercator().scale(1050).translate([-1300,1200]);
		path = d3.geo.path().projection( projection );
		console.log(projection);
		console.log(path);
		return {path: path, projection: projection};
	},
	fills: {
		defaultFill: "#AAAAAA",
        stationL: "#CC0000", //red
        stationM: "#CCCC00",//yello
        stationH: "#00CC00" //green
	}
});
var chinaStation = [50136099999,50434099999,50564099999,50888099999,51431099999,51463099999,51709099999,51811099999,51828099999,51886099999,52203099999,52418099999,52436099999,52495099999,52602099999,52737099999,52787099999,52818099999,52836099999,53083099999,53336099999,53352099999,53391099999,53564099999,53646099999,53705099999,53787099999,53923099999,53959099999,54012099999,54026099999,54259099999,54273099999,54292099999,54337099999,54377099999,54511099999,54808099999,54823099999,54843099999,54863099999,55228099999,55279099999,55578099999,55696099999,56004099999,56065099999,56106099999,56167099999,56247099999,56444099999,56492099999,56748099999,56954099999,56985099999,57328099999,57476099999,57598099999,57745099999,57816099999,58221099999,58345099999,58367099999,58633099999,58754099999,58968099999,59007099999,59117099999,59134099999,59278099999,59316099999,59358099999,59431099999,59456099999,59493099999,59845099999];
var bubbleArray = [];
var objmp={};
d3.csv("data/stationData.csv", function (datas){
	datas = datas.filter(function (station) {
		if (chinaStation.indexOf(parseInt(station.id)) > -1)
		{
			var location = [+station.long, +station.lat];
			objmp[station.id] = {};
			objmp[station.id]["name"] = station.name;
			objmp[station.id]["radius"] = 10;
			objmp[station.id]["org"] = location;
			objmp[station.id]["pos"] = projection(location);
			objmp[station.id]["latitude"]= objmp[station.id]["org"][1];
			objmp[station.id]["longitude"]= objmp[station.id]["org"][0];
			objmp[station.id]["fillKey"]= 'stationM';
            bubbleArray.push(objmp[station.id]);
			return true;
		}
	});
	console.log(objmp);
	map.bubbles(bubbleArray,{
		popupTemplate: function(geo, data) {
            return '<div class="hoverinfo">'
                + "Name:"+data.name  
                + '</div>';
		}
	});
});
		</script>
	</body>
</html>
